- name: Create minecraft backups directory
  file:
    path: "{{ minecraft_dir }}/backups/"
    state: directory
    owner: "{{ minecraft_user }}"
    group: "{{ minecraft_user }}"
    mode: '755'

- name: Write minecraft server template files
  no_log: true
  become: yes
  become_user: "{{ minecraft_user }}"
  template:
    owner: "{{ minecraft_user }}"
    group: "{{ minecraft_user }}"
    # Note: this has to be a string, not an int!!
    mode: '660'
    src: "{{ item.src }}"
    dest: "{{ minecraft_dir }}/{{ item.path }}"
  with_community.general.filetree: templates/server/

# ----- ----- ----- ----- -----

- name: Write minecraft variables to files
  no_log: true
  copy:
    content: "{{ item.content }}"
    dest: "{{ minecraft_dir }}/{{ item.dest }}"
    owner: "{{ minecraft_user }}"
    group: "{{ minecraft_user }}"
    # Note: this has to be a string, not an int!!
    mode: '660'
  loop:
    - { dest: ".mcrcon.pass", content: "{{ mcrcon_pass }}" }
    - { dest: ".world.name", content: "{{ minecraft_world_name }}" }
